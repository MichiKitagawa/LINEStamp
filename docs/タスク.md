* [ ] **1. プロジェクト準備**

  * [ ] リポジトリを初期化し、フォルダ構成を作成する
    * [ ] `frontend/`（Next.js）ディレクトリ作成
    * [ ] `backend/`（Express + TypeScript）ディレクトリ作成
    * [ ] モノレポ構成 (必要に応じて) を検討し、設定ファイル（`package.json` や `tsconfig.json`）を配置
  * [ ] CI/CD の初期設定
    * [ ] GitHub Actions のワークフローを作成
      * [ ] プッシュ時に Lint、ビルド、テストを実行
      * [ ] Cloud Run へのデプロイ検証（ステージングブランチ用）
    * [ ] 環境変数管理方法を決定（`.env.example` を作成）
  * [ ] 共通設定・依存関係のインストール
    * [ ] `backend/`：`express`, `firebase-admin`, `stripe`, `sharp`, `puppeteer-core` などをインストール
    * [ ] `frontend/`：`next`, `react`, `firebase`, `tailwindcss`, `zustand`（必要時）などをインストール
  * [ ] **テスト**
    * 本タスクには特定のテストはなし

---

* [ ] **2. 認証・アカウント管理 (UC01, UC07)**

  * [ ] Firebase プロジェクトを作成し、Authentication (Google プロバイダー) を有効化
  * [ ] `frontend/src/utils/firebaseClient.ts` を作成し、Firebase SDK を初期化
    * [ ] 環境変数から `NEXT_PUBLIC_FIREBASE_API_KEY` や `NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN` などを読み込む
  * [ ] フロントエンド：ログイン画面 (P01) 実装
    * [ ] `/pages/login.tsx` を作成
      * [ ] 「Googleでログイン」ボタン設置
      * [ ] ボタン押下で `firebase.auth().signInWithPopup(googleProvider)` を呼び出す
      * [ ] 認証中はスピナー表示 (`state: loading`)
      * [ ] 成功後：アクセストークンを取得し、バックエンドに送信せずにダッシュボードへ遷移
    * [ ] Session チェック用ユーティリティ作成
      * [ ] `frontend/src/hooks/useAuth.ts`：`onAuthStateChanged` でログイン状態を監視
    * [ ] **テスト**
      * ユニットテスト:  
        - 3.1-01〜3.1-04（E2Eテスト）  
        - フックの単体: `useAuth.test.ts`（テスト番号 1.1.2-…）
  * [ ] バックエンド：ID トークン検証ミドルウェア実装
    * [ ] `backend/src/middleware/verifyIdToken.ts` を作成
      * [ ] Authorization ヘッダーからトークンを取得
      * [ ] `firebase-admin.auth().verifyIdToken()` で検証し、`req.uid` にセット
      * [ ] トークン未提供／検証失敗時は 401 を返却
    * [ ] **テスト**
      * ユニットテスト: `verifyIdToken.test.ts`  
        - 1.1.1-01, 1.1.1-02, 1.1.1-03
  * [ ] バックエンド：`GET /auth/session` エンドポイント実装
    * [ ] ルート定義 (`backend/src/routes/auth.ts`) に `GET /session` を追加
      * [ ] ミドルウェア `verifyIdToken` を適用
      * [ ] Firestore の `users/{uid}` からユーザー情報を取得し返却
    * [ ] **テスト**
      * ユニットテスト: `authSession.test.ts`  
        - 1.1.2-01, 1.1.2-02, 1.1.2-03
  * [ ] フロントエンド：ダッシュボード画面 (P02) 実装
    * [ ] `/pages/dashboard.tsx` を作成
      * [ ] `GET /auth/session` を呼び出してユーザー情報を取得
      * [ ] トークン残数表示エリア設置（「所持トークン: XX枚」）
      * [ ] 「ログアウト」ボタン押下で `firebase.auth().signOut()` を実行 → `/login` へ遷移
      * [ ] 「トークン購入」「スタンプ作成を始める」ボタンを設置
      * [ ] UI コンポーネントは Tailwind CSS でスタイリング
    * [ ] **テスト**
      * E2Eテスト: 3.1-01〜3.1-04
  * [ ] バックエンド：ユーザー情報初期化機能
    * [ ] `verifyIdToken` の検証時に Firestore の `users/{uid}` が存在しなければ作成する処理を追加
    * [ ] `users` コレクションに `displayName`, `email`, `tokenBalance = 0` をセット
    * [ ] **テスト**
      * ユニットテスト: `authSession.test.ts`（1.1.2-02, 1.1.2-03でカバー）

---

* [ ] **3. トークン管理・決済 (UC02)**

  * [ ] フロントエンド：トークン購入画面 (P03) 実装
    * [ ] `/pages/purchase.tsx` を作成
      * [ ] トークンパッケージ選択ラジオ（例: 40tokens, 80tokens）を表示
      * [ ] 選択後に「購入する」ボタン押下 → `POST /tokens/checkout-session` を呼び出す
      * [ ] `creatingSession` 状態でローディング表示 → 成功時に受け取った `sessionId` で Stripe Checkout へリダイレクト
      * [ ] 決済完了後は自動的に `/dashboard` へリダイレクトされる前提とする
    * [ ] **テスト**
      * ユニットテスト: `tokensCheckoutSession.test.ts`  
        - 1.2.1-01, 1.2.1-02
      * E2Eテスト: 3.2-01〜3.2-04
  * [ ] バックエンド：Stripe セッション作成エンドポイント実装
    * [ ] `backend/src/routes/tokens.ts` に `POST /checkout-session` を追加
      * [ ] リクエストボディから `tokenPackage` を取得 (`"40tokens"` や `"80tokens"`)
      * [ ] Stripe SDK で Checkout セッションを作成
        * [ ] `metadata.userId = req.uid`, `metadata.tokenPackage = tokenPackage` を設定
      * [ ] レスポンスに `sessionId` を含める
    * [ ] **テスト**
      * ユニットテスト: `tokensCheckoutSession.test.ts`（1.2.1-01, 1.2.1-02）
  * [ ] バックエンド：`POST /webhook/stripe` 受信エンドポイント実装
    * [ ] `stripe.webhooks.constructEvent` で署名検証
    * [ ] `checkout.session.completed` イベントを検知
    * [ ] `session.metadata.userId`, `session.metadata.tokenPackage` からユーザーIDとトークン数を算出
    * [ ] Firestore トランザクションで:
      * [ ] `users/{userId}.tokenBalance` をインクリメント
      * [ ] `token_transactions` コレクションにレコード保存
    * [ ] Webhook 応答 (200 OK) を返却
    * [ ] 環境変数 `STRIPE_SECRET_KEY`, `STRIPE_WEBHOOK_SECRET` を `.env` に設定
    * [ ] **テスト**
      * ユニットテスト: `stripeWebhook.test.ts`  
        - 1.2.3-01, 1.2.3-02, 1.2.3-03
  * [ ] フロントエンド：ダッシュボードで残数取得機能を追加
    * [ ] `GET /tokens/balance` を定義し、フロントで呼び出して表示
    * [ ] **テスト**
      * ユニットテスト: `getBalance.test.ts`  
        - 1.2.2-01, 1.2.2-02
      * E2Eテスト: 3.2-04
  * [ ] バックエンド：`GET /tokens/balance` エンドポイント実装
    * [ ] Firestore の `users/{uid}.tokenBalance` を取得し返却
    * [ ] **テスト**
      * ユニットテスト: `getBalance.test.ts`（1.2.2-01, 1.2.2-02）

---

* [ ] **4. 画像アップロード・プリセット (UC03, UC03b)**

  * [ ] Firestore と Firebase Storage の設定
    * [ ] Firebase Security Rules を設定し、ユーザーの `uid` ごとにアクセスを制限
    * [ ] **テスト**
      * 特定テストなし（セキュリティルールは別途手動検証推奨）

  * [ ] フロントエンド：画像アップロード画面 (P04) 実装
    * [ ] `/pages/upload.tsx` を作成
      * [ ] ドラッグ＆ドロップ対応のファイル選択フォーム（最大 8 枚、PNG/JPEG）を実装
      * [ ] 選択されたファイルをサムネイルとして表示
      * [ ] トークン残数 (`GET /tokens/balance`) と選択枚数 × 5 を比較し、不足時は「トークンを購入する」へ誘導
      * [ ] 「次へ（生成開始）」ボタン押下 → `POST /images/upload` を実行
      * [ ] バリデーション (ファイル数 1～8, 各 5MB 以下, PNG/JPEG) をフロントで実装
    * [ ] アップロード中はローディングインジケーターを表示
    * [ ] アップロード成功後にステータスを `pending_upload → generating` に更新 (API 側で行う) → 生成中画面 (P05) へ遷移
    * [ ] **テスト**
      * ユニットテスト: `imagesUpload.test.ts`  
        - 1.3.1-01, 1.3.1-02, 1.3.1-03, 1.3.1-04
      * E2Eテスト: 3.3-02, 3.3-03

  * [ ] バックエンド：画像アップロードエンドポイント実装
    * [ ] `backend/src/routes/images.ts` に `POST /upload` を追加
      * [ ] `multer` などで Multipart/Form を受け取り、各ファイルを Firebase Storage へアップロード
        * 保存パス例: `users/{uid}/stamps/{stampId}/original/{filename}`
      * [ ] Firestore に以下を保存
        * `images` コレクションに:
          * `stampId`, `type: "original"`, `url`, `sequence`, `createdAt`
      * [ ] レスポンスにアップロード成功件数を含める
    * [ ] `stamps/{stampId}` ドキュメントを作成または更新し、`status = "generating"` にセット
    * [ ] **テスト**
      * ユニットテスト: `imagesUpload.test.ts`（1.3.1-01〜1.3.1-04）
      * 結合テスト: 2.2-02, 2.2-03

  * [ ] フロントエンド：プリセット選択画面 (P04b) 実装
    * [ ] `/pages/preset.tsx` を作成
      * [ ] `GET /presets/list` を呼び出し、プリセット一覧（ID, ラベル, サムネイルURL）を取得
      * [ ] サムネイルカードまたはラジオボタンで選択できる UI を実装
      * [ ] 選択後に「このプリセットで生成」ボタン押下 → `POST /stamps/set-preset` 実行
    * [ ] バリデーション: プリセット未選択時はボタン非活性
    * [ ] **テスト**
      * ユニットテスト: `getPresetsList.test.ts`（1.3.2-01, 1.3.2-02）, `setPreset.test.ts`（1.3.3-01, 1.3.3-02）
      * 結合テスト: 2.2-02, 2.2-03

  * [ ] バックエンド：プリセット関連エンドポイント実装
    * [ ] `GET /presets/list` を実装
      * [ ] Firestore の `presets` コレクションを参照
      * [ ] レスポンスに `id`, `label`, `thumbnailUrl` を返却
    * [ ] `POST /stamps/set-preset` を実装
      * [ ] リクエストボディから `stampId`, `presetId` を受け取る
      * [ ] `presets/{presetId}` の存在を確認
      * [ ] `stamps/{stampId}` に `presetId`, `presetConfig = presets/{presetId}.config` を更新
      * [ ] `stamps/{stampId}.status = "generating"` にセット
      * [ ] 生成中画面 (P05) へのレスポンスを返却
    * [ ] **テスト**
      * ユニットテスト: `getPresetsList.test.ts`（1.3.2-01, 1.3.2-02）, `setPreset.test.ts`（1.3.3-01, 1.3.3-02）
      * 結合テスト: 2.2-02, 2.2-03

---

* [ ] **5. スタンプ生成処理 (UC04)**

  * [ ] バックエンド：スタンプ整形ジョブのモック実装
    * [ ] 画像生成API（本来は外部サービスを呼ぶ想定）をモック化する
      * [ ] `backend/src/services/imageGeneratorMock.ts` にダミー関数を作成
        * 入力: `stampId`, 保存済みオリジナル画像のURLリスト
        * 出力: Firebase Storage に白背景（または透過）で 370×320px のダミー画像を 8 枚生成して保存
        * Firestore の `images` コレクションへ `type: "processed"`, `url`, `sequence`, `createdAt` を保存
      * [ ] 将来的に実際の画像生成APIと差し替えるため、サービスインターフェースを定義
    * [ ] **テスト**
      * 特定テストなし（モック自体はユニットでカバー不要）

  * [ ] バックエンド：`POST /stamps/generate` エンドポイント実装
    * [ ] `stamps/{stampId}.status` が `"pending_upload"` もしくは `"pending_generate"` か検証
    * [ ] Firestore トランザクションで `stamps/{stampId}.status = "generating"` に更新
    * [ ] 上記のモック関数を非同期で実行
    * [ ] モック処理完了後、`stamps/{stampId}.status = "generated"` に更新
    * [ ] Firestore の `images` コレクションに `type: "processed"` のレコードを追加
    * [ ] レスポンスに `stampId` と `status: "generating"` を返却
    * [ ] **テスト**
      * ユニットテスト: `generateStamp.test.ts`  
        - 1.4.2-01, 1.4.2-02, 1.4.2-03
      * 結合テスト: 2.2-03, 2.2-04

  * [ ] バックエンド：`GET /stamps/{stampId}/status` を実装
    * [ ] Firestore から `stamps/{stampId}.status` と `retryCount` を取得して返却
    * [ ] **テスト**
      * ユニットテスト: `getStampStatus.test.ts`  
        - 1.4.3-01, 1.4.3-02

  * [ ] フロントエンド：生成中画面 (P05) 実装
    * [ ] `/pages/generating.tsx` を作成
      * [ ] ルートパラメータまたはクエリに `stampId` を受け取る
      * [ ] ページロード時に `POST /tokens/consume` → `POST /stamps/generate` を順に呼び出す
        * [ ] `POST /tokens/consume` リクエストボディ: `{ stampId, amount: 5 × 画像数 }`
        * [ ] 5トークン × 8画像 = 40トークン
      * [ ] その後、`GET /stamps/{stampId}/status` をポーリング (1～2秒間隔)
        * [ ] `status === "generated"` になったらプレビュー画面 (P06) へ遷移
        * [ ] `status === "failed"` になったらエラー画面 (P09) へ遷移
      * [ ] 処理中はローディングスピナーと進捗メッセージを表示
    * [ ] バリデーション: 画面操作不可（常に処理中状態）
    * [ ] **テスト**
      * ユニットテスト: `consumeTokens.test.ts`（1.4.1-01, 1.4.1-02）, `generateStamp.test.ts`（1.4.2-…）, `getStampStatus.test.ts`（1.4.3-…）
      * 結合テスト: 2.2-03, 2.2-04
      * E2Eテスト: 3.3-04

---

* [ ] **6. プレビュー・申請 (UC05, UC06)**

  * [ ] フロントエンド：プレビュー画面 (P06) 実装
    * [ ] `/pages/preview/[stampId].tsx` を作成
      * [ ] `getServerSideProps` またはクライアントで `GET /stamps/{stampId}/preview` を呼び出し、8枚の加工済み画像URLとメイン画像URLを取得
      * [ ] サムネイルグリッドで 8 枚を表示
      * [ ] 「申請」ボタン押下 → `POST /stamps/submit` を呼び出す
      * [ ] 申請中 (`submitting` 状態) はボタンをローディングに変更
      * [ ] 成功後は申請進捗画面 (P07) へ遷移
    * [ ] バリデーション: 画像不足 (取得失敗) 時はエラー表示し、再アップロードへ誘導
    * [ ] **テスト**
      * ユニットテスト: `previewStamp.test.ts`（1.5.1-01, 1.5.1-02）
      * E2Eテスト: 3.4-01〜3.4-05

  * [ ] バックエンド：プレビュー取得エンドポイント実装
    * [ ] `GET /stamps/{stampId}/preview` を実装
      * [ ] Firestore から `images` コレクションで `stampId` かつ `type="processed"` のレコードをシーケンス順に取得
      * [ ] メイン画像 (`type="main"`) があれば含める
      * [ ] 取得した URL 配列を返却
    * [ ] **テスト**
      * ユニットテスト: `previewStamp.test.ts`（1.5.1-01, 1.5.1-02）
      * 結合テスト: 2.3-02

  * [ ] バックエンド：申請開始エンドポイント (モック) 実装
    * [ ] `POST /stamps/submit` を実装
      * [ ] Firestore から `stamps/{stampId}` を取得し、`status === "generated"` であることを検証
      * [ ] `stamps/{stampId}.status = "submitting"` に更新
      * [ ] モック化した Puppeteer 処理をキックする（非同期ジョブスタイルで良い）
        * [ ] 本来は LINE Creators Market にアクセスして申請するが、モックとして 5 秒スリープ後に `status = "submitted"` に更新
      * [ ] レスポンスに `{ stampId, status: "submitting" }` を返却
    * [ ] **テスト**
      * ユニットテスト: `submitStamp.test.ts`（1.5.2-01, 1.5.2-02）
      * 結合テスト: 2.3-03

  * [ ] フロントエンド：申請進捗画面 (P07) 実装
    * [ ] `/pages/status/[stampId].tsx` を作成
      * [ ] クライアントで `GET /stamps/{stampId}/status` をポーリング (1～2秒間隔)
        * [ ] `status === "submitted"` → 申請完了画面 (P08) へ遷移
        * [ ] `status === "failed"` → エラー画面 (P09) へ遷移
        * [ ] `status === "session_expired"` → 再認証画面 (P10) へ遷移
      * [ ] 進捗ログ表示エリア：モックで生成したログを表示 (例: 「Puppeteer 起動中」「LINEにログイン中」「メタデータ入力中」など)
      * [ ] 状態に応じて適切なメッセージとスピナーを切り替え
    * [ ] UI 操作はできない (常に進捗表示)
    * [ ] **テスト**
      * ユニットテスト: `getStampStatus.test.ts`（1.4.3-01, 1.4.3-02）
      * 結合テスト: 2.3-03
      * E2Eテスト: 3.4-01〜3.4-05

  * [ ] バックエンド：エラー再申請エンドポイント実装 (UC09)
    * [ ] `POST /stamps/retry` を実装
      * [ ] Firestore から `stamps/{stampId}` を取得し、`status === "failed"` を検証
      * [ ] `submission_attempts` から最新の `attemptNo` を取得し `attemptNo + 1` で新規レコード作成
      * [ ] `stamps/{stampId}.retryCount++` して `status = "submitting"` に更新
      * [ ] Puppeteer モックジョブを再度キックし、完了時に `status = "submitted"` もしくは `failed/session_expired` を更新
      * [ ] レスポンスに `{ stampId, status: "submitting", retryCount }` を返却
    * [ ] **テスト**
      * ユニットテスト: `retryStamp.test.ts`（1.5.3-01, 1.5.3-02）
      * 結合テスト: 2.3-04

---

* [ ] **7. エラー・ステータス復旧 (UC08, UC09)**

  * [ ] フロントエンド：エラー画面 (P09) 実装
    * [ ] `/pages/error/[stampId].tsx` を作成
      * [ ] クエリや props で受け取ったエラー内容を表示 ("生成エラー" または "申請エラー")
      * [ ] `status === "failed"` 時: 「再申請する」ボタンを表示 → 押下で `POST /stamps/retry`
      * [ ] `status === "session_expired"` 時: 「LINE再ログイン」ボタン表示 → 押下で再認証画面 (P10) へ遷移
      * [ ] 「ダッシュボードへ戻る」リンクを設置
    * [ ] API 呼び出し中はローディング表示
    * [ ] **テスト**
      * ユニットテスト: なし（フロントのみ UI 検証）
      * E2Eテスト: 3.5.1-01, 3.5.1-02, 3.5.1-03

  * [ ] フロントエンド：LINE再認証画面 (P10) 実装
    * [ ] `/pages/relogin/[stampId].tsx` を作成
      * [ ] Puppeteer の LINE Login モックビューを埋め込む (iframe やウィジェットではなく、「LINEにログインしてください」とメッセージ表示)
      * [ ] 「ログイン完了後、自動で申請を再開します」テキストを表示
      * [ ] 一定時間後 (例: 5 秒後) に `POST /stamps/submit` を自動で再キック (モック再申請時のフロー)
      * [ ] 「キャンセル」ボタン → `/error/[stampId]` へ戻る
    * [ ] 状態管理: `waitingLogin`, `success`, `failure`
    * [ ] **テスト**
      * ユニットテスト: なし（フロントのみ UI 検証）
      * E2Eテスト: 3.5.2-01, 3.5.2-02, 3.5.2-03

  * [ ] バックエンド：ステータス復旧機能確認用エンドポイント
    * [ ] `GET /stamps/status?userId={userId}` を実装
      * [ ] Firestore から指定ユーザーのすべての `stampId`, `status`, `retryCount` を取得し返却
    * [ ] **テスト**
      * ユニットテスト: `getAllStatuses.test.ts`（想定 1.**, 実装後に作成）

---

* [ ] **8. テスト設計・実装**

  * [ ] ユニットテスト  
    * [ ] バックエンド各エンドポイントに対して `Jest` + `supertest` を使い、入力バリデーションや正常系／異常系レスポンスをカバー  
      * [ ] `GET /auth/session`, `GET /tokens/balance`
      * [ ] `POST /tokens/checkout-session`, `POST /webhook/stripe`
      * [ ] `POST /images/upload`, `POST /stamps/generate`, `POST /stamps/submit`, `POST /stamps/retry`, `GET /stamps/{stampId}/status`, `GET /presets/list`, `POST /stamps/set-preset`
      * [ ] **テスト一覧参照**（セクション 1.x）
    * [ ] フロントエンドの各カスタムフックやユーティリティ関数に対するテスト (React Testing Library + Jest)  
      * [ ] `useAuth.ts: ログイン状態が正しく更新されるか`  
      * [ ] `useFetchBalance.ts` など、API 呼び出し用フック  
      * [ ] **テスト一覧参照**（セクション 1.x）

  * [ ] 結合テスト  
    * [ ] バックエンドと Firestore のエミュレータを使い、主要なフローを検証  
      * [ ] スタンプ作成 → 画像アップロード → 生成 → プレビュー取得 → 申請 → ステータス遷移  
      * [ ] エラーシナリオ (生成失敗、申請失敗、セッション切れ) の動作確認  
    * [ ] テストファイル:  
      * `tests/integration/auth-token-flow.test.ts`（2.1-01〜2.1-06）  
      * `tests/integration/image-generate-flow.test.ts`（2.2-01〜2.2-04）  
      * `tests/integration/preview-submit-flow.test.ts`（2.3-01〜2.3-04）

  * [ ] フロントエンド E2E テスト (Playwright または Cypress)  
    * [ ] Chrome エミュレータ上で以下を自動実行:  
      * [ ] `/login` → Google ログインモック → `/dashboard` 表示確認  
      * [ ] `/purchase` → `POST /tokens/checkout-session` モック → Stripe Checkout モック → 残数更新  
      * [ ] `/upload` → 画像ファイル選択シミュレーション → `/images/upload` モック → `/generating` へ遷移 → ポーリングで `/preview` へ遷移  
      * [ ] `/preview` → 「申請」押下 → `/status` へ遷移 → モックで最終的に `/success` へ遷移  
      * [ ] エラー条件 (例: トークン不足、画像バリデーション NG, 生成エラー) の確認  
    * [ ] テストファイル:  
      * `e2e/specs/auth-dashboard.spec.ts`（3.1-01〜3.1-04）  
      * `e2e/specs/purchase-balance.spec.ts`（3.2-01〜3.2-04）  
      * `e2e/specs/upload-generate-preview.spec.ts`（3.3-01〜3.3-05）  
      * `e2e/specs/preview-submit-status.spec.ts`（3.4-01〜3.4-05）  
      * `e2e/specs/error.spec.ts`（3.5.1-01〜3.5.1-03）  
      * `e2e/specs/relogin.spec.ts`（3.5.2-01〜3.5.2-03）

  * [ ] テストデータの準備
    * [ ] Firestore エミュレータ用データシードスクリプト作成
      * [ ] `users`, `presets` コレクションにサンプルデータを投入
    * [ ] テスト実行前にエミュレータ起動スクリプトを用意

---

* [ ] **9. デプロイ・本番準備**

  * [ ] Dockerfile 作成 (バックエンド用)
    * [ ] `node:18-alpine` ベース、Chromium インストール、`npm run build` → `node dist/index.js`
    * [ ] Puppeteer 用の環境変数 `PUPPETEER_EXECUTABLE_PATH` 設定
  * [ ] Cloud Run サービス設定 (ステージング / 本番)
    * [ ] ステージング用: `time-stamp-staging` 、メモリ 512MiB 以上
    * [ ] 本番用: `time-stamp-prod` 、必要なインスタンス数を設定
  * [ ] フロントエンドのビルド・ホスティング設定
    * [ ] Next.js を静的ビルド (`npm run build && npm run export`) し、適当なホスティング（Vercel など）にデプロイ
    * [ ] 環境変数 `NEXT_PUBLIC_FIREBASE_*` を設定
  * [ ] リリース前チェックリスト
    * [ ] 全テストが通過していること
    * [ ] Firebase Security Rules が正しく動作することを検証
    * [ ] Stripe Webhook の署名検証が機能していることを確認
    * [ ] モックではない実際の環境で画像生成APIが動作する場合は、本番キーを設定し動作確認（後日）
    * [ ] LINE 申請フローを限定ユーザーで検証（本番での連続申請は慎重に）
  * [ ] **テスト**
    * Docker関連の動作確認: `docker build` & `docker run` でヘルスチェック (ユニット／統合の対象外)

---

* [ ] **10. モックから本物への切り替え (将来)**

  * [ ] 画像生成API をモックから本番 API に差し替え
    * [ ] `imageGeneratorMock.ts` → `imageGeneratorService.ts` へ置き換え
    * [ ] 実際のサービスキーやエンドポイントを環境変数から読み込む
    * [ ] Firestore に正しい加工済み画像を保存する処理を実装
    * [ ] モック用のユニットテストを削除または修正
    * [ ] **テスト**
      * 必要なユニットテストの更新（`generateStamp.test.ts` のリファクタリング）
  * [ ] LINE 申請フローをモックから実運用に切り替え
    * [ ] Puppeteer スクリプトを実際の LINE Creators Market に対応させる
      * [ ] 実際のログイン → Cookie 保存
      * [ ] 申請フォーム操作 (タイトル, 説明, カテゴリ, タグ, 画像アップロード, 申請ボタンクリック) を実装
      * [ ] レスポンスの DOM 検出や完了メッセージ抽出を実装
    * [ ] 連続申請による BAN リスクを低減するための待機ロジックまたは間隔設定を追加
    * [ ] プロダクション環境での動作確認を限定的に行い、問題がなければ正式有効化
    * [ ] **テスト**
      * 実運用化に合わせて E2E テストの検証ケースを更新（`preview-submit-status.spec.ts` の追加シナリオ）
  * [ ] 有料ツール・アクセスのモック解除
    * [ ] 必要に応じて Stripe API を本番キーに切り替え
    * [ ] Firestore エミュレータではなく、実際の Firestore へデータを保存
    * [ ] CI/CD のデプロイ先を本番環境に変更
    * [ ] **テスト**
      * 本番 Key を用いた結合テスト／E2E テストの動作確認
