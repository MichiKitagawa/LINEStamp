# P01: ログイン画面

## 概要
Google アカウントによる OAuth 認証を開始し、ログイン状態を確立する。  
認証成功後はダッシュボード（P02）へ遷移する。

## UI 構成要素
- 「Google でログイン」ボタン  
- アプリロゴ／タイトル  
- 認証中インジケーター（ローディングスピナー）

## 状態管理
- `idle`: 初期状態、ログインボタン活性  
- `loading`: OAuth リクエスト中、ボタンと UI を無効化

## バリデーション
- 特になし（ボタン押下で OAuth 開始）

## 使用 API
- **GET** `/auth/google`  
- **GET** `/auth/session`（起動時に既ログインチェック）

## 遷移先
- 認証成功 → P02（ダッシュボード画面）  
- 認証失敗 → 同画面にエラーメッセージ表示（フロント完結）

---

# P02: ダッシュボード

## 概要
ユーザーの基本情報とトークン残数を表示し、スタンプ作成へのエントリポイントとして機能する。申請中・申請済みスタンプの状況確認と重複申請防止機能を提供する。

## UI 構成要素
- ヘッダー（ユーザー名、ログアウトボタン）
- トークン残数表示（例: "所持トークン: 120 枚")  
- 「トークン購入」ボタン  
- 「スタンプ作成を始める」ボタン（条件付きで無効化）
- 申請中・申請済みスタンプがある場合の警告表示
- スタンプ申請状況一覧（最新5件）
- サービス機能紹介

## 状態管理
- `loading`: ユーザー情報読み込み中
- `loaded`: 通常表示状態
- `error`: エラー発生時

## バリデーション
- トークン残数チェック（スタンプ作成時）
- 申請中・申請済みスタンプの有無チェック

## 使用 API
- **GET** `/auth/session`（ユーザー情報取得）
- **GET** `/tokens/balance`（トークン残数取得）
- **GET** `/stamps/status`（ユーザーのスタンプ一覧取得）

## 遷移先
- 「トークン購入」 → P03（購入画面）
- 「スタンプ作成を始める」 → P04（アップロード画面）
  - トークン不足時は自動的にP03へリダイレクト
  - 申請中・申請済みスタンプがある場合は作成不可

## 重複申請防止機能
- 申請中（submitting）または申請済み（submitted）スタンプがある場合：
  - 新規スタンプ作成ボタンを無効化
  - 警告メッセージを表示
  - 審査結果を待つことの重要性を説明
- スタンプ申請状況の可視化：
  - 申請中、申請済み、失敗、セッション切れ状態を色分け表示
  - 申請日時の表示
  - 審査所要期間の説明

## 注意事項
- モック認証時もスタンプ状況の確認は実行
- リアルタイムでスタンプ状況を更新（更新ボタン）
- 重複申請の防止とユーザー教育を重視

---

# P03: トークン購入画面

## 概要
Stripe を使ってトークンパッケージを購入する。購入完了後、自動的に残数が更新される。

## UI 構成要素
- トークンパッケージ選択ラジオ（例: 40 トークン／80 トークン）  
- 「購入する」ボタン  
- 購入中ローディングインジケーター  
- 「戻る」ボタン

## 状態管理
- `idle`: 選択待ち  
- `creatingSession`: Checkout セッション生成中  
- `redirecting`: Stripe 決済ページへ遷移中

## バリデーション
- パッケージ未選択時：「購入する」ボタン非活性

## 使用 API
- **POST** `/tokens/checkout-session`

## 遷移先
- 決済ページ（外部 Stripe へリダイレクト）  
- 決済完了後自動でダッシュボード（P02）へ戻る

---

# P04: 画像アップロード画面

## 概要
LINE スタンプ用の画像を最大 8 枚まで選択・アップロードし、一時保存する。

## UI 構成要素
- ファイル選択フォーム（ドラッグ＆ドロップ対応、複数選択可）  
- 選択中サムネイル一覧  
- 所持トークン残数表示  
- 「次へ（生成開始）」ボタン  
- エラーメッセージ表示エリア

## 状態管理
- `idle`: 未選択  
- `selected`: ファイル選択済み  
- `validating`: 枚数・形式チェック中  
- `uploading`: サーバー送信中  
- `uploaded`: アップロード完了

## バリデーション
- ファイル形式: PNG/JPEG のみ受け付け  
- 枚数: 1～8 枚  
- トークン残数 ≥ 選択枚数 × 5

## 使用 API
- **GET** `/tokens/balance`  
- **POST** `/images/upload`

## 遷移先
- アップロード成功 → P05（生成中画面）  
- バリデーション NG → 同画面でエラー表示

---

# P04b: プリセット選択画面

## 概要
生成処理に用いるスタンプのプリセット（スタイル）をユーザーに選択させる。

## UI 構成要素
- プリセットサムネイル一覧（カード or ラジオ）  
- プリセット名／説明テキスト  
- 「このプリセットで生成」ボタン  
- 「戻る」ボタン（P04 へ戻る）

## 状態管理
- `idle`: プリセット未選択  
- `selected`: プリセット選択済み  
- `saving`: 選択内容送信中

## バリデーション
- プリセット未選択時：「生成」ボタン非活性

## 使用 API
- **GET** `/presets/list` → プリセット一覧取得  
- **POST** `/stamps/set-preset` → 選択プリセットを保存

## 遷移先
- 保存成功 → P05（生成中画面）  
- キャンセル → P04（画像アップロード画面）

---

# P05: 生成中画面

## 概要
アップロードした画像を LINE スタンプ形式に整形し、トークンを消費して生成処理を実行する。

## UI 構成要素
- 処理中スピナー  
- 「スタンプを生成しています…」メッセージ  
- 進捗バー（オプション）

## 状態管理
- `processing`: 生成リクエスト送信＆ステータス取得中  
- `success`: 生成完了検知  
- `error`: 生成失敗検知

## バリデーション
- 画面操作不可（常に処理中表示）

## 使用 API
- **POST** `/tokens/consume`  
- **POST** `/stamps/generate`  
- **GET** `/stamps/status`（ポーリング）

## 遷移先
- `status = generated` → P06（プレビュー画面）  
- `status = failed` → P09（エラー画面）

---

# P06: プレビュー画面

## 概要
生成済みスタンプをユーザーにプレビュー表示し、申請をトリガーする。

## UI 構成要素
- 8 枚のスタンププレビュー（サムネイル）  
- 「申請」ボタン  
- 戻るボタン（再アップロードへ戻る）  
- メイン画像プレビュー（オプション）

## 状態管理
- `idle`: プレビュー待ち  
- `submitting`: 申請リクエスト送信中

## バリデーション
- プレビュー画像取得失敗時：エラー表示  
- 画像枚数不足時：警告表示

## 使用 API
- **GET** `/stamps/{stampId}/preview`  
- **POST** `/stamps/submit`

## 遷移先
- 申請開始 → P07（申請進捗画面）  
- 戻る → P04

---

# P07: 申請進捗画面

## 概要
Puppeteer での LINE 自動申請フロー（Cookie 確認 → ログイン → 画像・メタデータ送信）の進捗を表示し、完了またはエラーをハンドリング。

## UI 構成要素
- ログ／ステータスメッセージ一覧  
- 処理中スピナー  
- 「中断」ボタン（オプション）

## 状態管理
- `submitting`: Puppeteer 起動＆DOM 操作中  
- `submitted`: 申請成功  
- `failed`: 申請失敗  
- `session_expired`: セッション切れ検知

## バリデーション
- 画面操作不可（進捗表示のみ）

## 使用 API
- **GET** `/stamps/{stampId}/status`（ポーリング）

## 遷移先
- `submitted` → P08（申請完了画面）  
- `failed` → P09（エラー画面）  
- `session_expired` → P10（LINE ログイン再認証画面）

---

# P08: 申請完了画面

## 概要
LINE への申請が正常に完了したことをユーザーに通知し、アプリでの作業完了を明確にする。重複申請防止のための警告も表示する。

## UI 構成要素
- 成功アイコン＋メッセージ（"🎉 申請完了！"）
- 申請プロセス完了の明確な表示
- 申請詳細情報（スタンプID、申請日時等）
- 「ダッシュボードへ戻る」ボタン（単一アクション）
- 重複申請防止の警告メッセージ
- 審査フローの説明
- 重複申請防止の詳細な注意事項

## 状態管理
- `loading`: スタンプ情報読み込み中
- `loaded`: 申請完了情報表示中
- `error`: エラー発生時

## バリデーション
- なし

## 使用 API
- **GET** `/stamps/{stampId}/status`（申請詳細取得）

## 遷移先
- 「ダッシュボードへ戻る」 → P02

## 重複申請防止機能
- 「新しいスタンプを作成」ボタンを削除
- 重複申請が問題である旨の警告表示
- 審査結果を待つことの重要性を強調
- アプリでの作業完了の明示

## 注意事項
- 申請後の変更・キャンセル不可の警告
- 審査結果待ちの必要性の説明
- 重複申請防止の重要性を強調

---

# P09: エラー画面

## 概要
自動申請または生成中に発生したエラー内容を表示し、再申請または再認証を提案する。

## UI 構成要素
- エラーメッセージ（原因別）  
- 「再申請する」ボタン  
- 「LINE 再ログイン」ボタン（セッション切れ時）  
- 「ダッシュボードへ戻る」リンク

## 状態管理
- `