# 機能一覧（ユースケース対応付き） - LINEスタンプ自動申請アプリ（Web版）

---

## 認証・アカウント管理

- **F01** - Google OAuthによるログイン機能  
  - 対応UC: UC01

- **F02** - セッション管理（永続化・認証状態の保持）  
  - 対応UC: UC01, UC07

- **F03** - ログアウト機能（セッションの削除）  
  - 対応UC: UC07

---

## トークン管理・決済

- **F04** - トークン購入画面の表示  
  - 対応UC: UC02

- **F05** - Stripe決済処理  
  - 対応UC: UC02

- **F06** - 購入完了後のトークン付与処理  
  - 対応UC: UC02

- **F07** - トークン残数の取得・表示  
  - 対応UC: UC02, UC03, UC04

- **F08** - トークン消費処理（1画像あたり5枚）  
  - 対応UC: UC04

---

## スタンプ画像の取り扱い

- **F09** - スタンプ画像の選択UI  
  - 対応UC: UC03

- **F10** - アップロード画像の形式・枚数チェック  
  - 対応UC: UC03

- **F11** - アップロード処理（サーバーへの送信）  
  - 対応UC: UC03

- **F12** - サーバー上での一時保存処理  
  - 対応UC: UC03

---

## スタンプ生成処理

- **F13** - 「生成」ボタンのUI表示  
  - 対応UC: UC04

- **F14** - スタンプ整形（画像のリサイズや整形など）  
  - 対応UC: UC04  
  - 入力: ユーザーがアップロードした画像（最大8枚、PNG/JPEG）  
  - 出力: サイズ 370×320px、PNG形式（透過維持または白背景）  
  - リサイズ処理: 比率を維持し、余白は白でパディング  
  - 背景処理: PNGの透過は維持、それ以外は白塗り処理  
  - 不足枚数: 白塗り画像で補完（例：5枚のみアップ → 残り3枚は白画像）  
  - 命名規則: `stamp01.png` ～ `stamp08.png`  
  - トークン消費: 1画像あたり5トークン、最大40トークン  
  - 使用ライブラリ（想定）: Pillow（Python）または sharp（Node.js）

- **F15** - トークン40枚消費ロジック（8枚 × 5）  
  - 対応UC: UC04

- **F16** - ステータス更新: `generated`  
  - 対応UC: UC04, UC08

- **F17** - プレビュー画面への遷移  
  - 対応UC: UC04, UC05, UC08

---

## スタンプ確認・申請処理

- **F18** - プレビュー画面のスタンプ表示  
  - 対応UC: UC05

- **F19** - 「申請」ボタンによる送信トリガー  
  - 対応UC: UC05, UC06

- **F20** - ステータス更新: `submitting`, `submitted`  
  - 対応UC: UC06, UC09

- **F21** - セッションチェック & LINE申請処理（Puppeteer 操作）  
  - 対応UC: UC06, UC08, UC09  
  - 処理フロー：  
    1. 保存済みCookieのロードを試行  
    2. Cookieが無効／未保存の場合はPuppeteerでLINE Creators Marketのログイン画面を開き、ユーザーに手動ログインを促す  
    3. ログイン完了後、Cookieを再保存し自動で申請フローに復帰  
    4. Puppeteerブラウザ上で以下を順に実行  
       - スタンプ新規作成ページへ遷移  
       - メタデータ（タイトル・説明・カテゴリ・タグ）自動入力  
       - スタンプ画像（8枚）＋メイン画像アップロード  
       - 「審査申請」ボタンクリック  
       - 完了メッセージ検知 or `stamp_id` 抽出  
    5. 成功時 → `submitted` に更新；失敗時 → `failed` または `session_expired` に更新

- **F22** - 完了画面表示  
  - 対応UC: UC06, UC09

---

## 異常時対応・ステータス復旧

- **F23** - ステータス取得（アプリ起動時に状態復元）  
  - 対応UC: UC08

- **F24** - ステータス別分岐処理  
  - `generated` → プレビュー表示  
  - `submitting` → 自動再申請  
  - `failed` → 再申請案内  
  - 対応UC: UC08

- **F25** - 申請失敗時のエラー表示（ログ・画面）  
  - 対応UC: UC09

- **F26** - ステータス更新: `failed`  
  - 対応UC: UC09

- **F27** - 再申請トリガー処理（手動 or 自動）  
  - 対応UC: UC09

- **F28** - retryCount等の再申請管理ロジック  
  - 対応UC: UC09

- **F29** - 再申請時のトークン再消費なし処理  
  - 対応UC: UC09
---
- **F30** - プリセット一覧の取得機能  
  - 対応UC: UC03b  
  - 説明: サーバーに用意したプリセット（ID・ラベル・サムネイル）を返却
- **F31** - プリセット選択UI  
  - 対応UC: UC03b  
  - 説明: サムネイルカードまたはラジオボタンでプリセットを選択
- **F32** - プリセット保存処理  
  - 対応UC: UC03b  
  - 説明: 選択したプリセットIDを stamp レコードに紐付けて保存

